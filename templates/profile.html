{% extends 'base.html' %}
{% load static %}

{% block title %}Profile - AI Interview Coach{% endblock %}

{% block content %}
<div class="profile-page">
    <!-- Profile Header -->
    <div class="profile-hero">
        <div class="hero-container">
            <div class="hero-left">
                <div class="profile-avatar">
                    <div class="avatar-circle">
                        <span class="avatar-initials">{{ user.username|slice:":2"|upper }}</span>
                    </div>
                    <div class="avatar-status">‚úì</div>
                </div>
                <div class="hero-info">
                    <h1 class="hero-name">{{ user.get_full_name|default:user.username }}</h1>
                    <p class="hero-role">{{ profile.job_role|default:"Set your target role" }}</p>
                    <div class="hero-meta">
                        <span class="meta-item">
                            <span class="meta-icon">üìß</span>
                            <span>{{ user.email }}</span>
                        </span>
                        <span class="meta-item">
                            <span class="meta-icon">üìÖ</span>
                            <span>Joined {{ user.date_joined|date:"M Y" }}</span>
                        </span>
                    </div>
                </div>
            </div>
            <div class="hero-actions">
                <a href="{% url 'dashboard' %}" class="action-btn secondary">
                    <span>‚Üê</span>
                    <span>Dashboard</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="profile-main">
        <div class="profile-grid">
            <!-- Left Column - Stats & Info -->
            <div class="profile-sidebar">
                <!-- Stats Card -->
                <div class="stats-card">
                    <h3 class="card-title">Profile Completion</h3>
                    <div class="completion-wrapper">
                        <div class="completion-circle">
                            <svg viewBox="0 0 36 36" class="circular-chart">
                                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                <path class="circle-progress" stroke-dasharray="{{ completion_percentage }}, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                            </svg>
                            <div class="percentage-text">{{ completion_percentage }}%</div>
                        </div>
                        <p class="completion-hint">Complete your profile to get better recommendations</p>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="quick-stats-card">
                    <h3 class="card-title">Quick Stats</h3>
                    <div class="stats-list">
                        <div class="stat-item">
                            <div class="stat-icon">üíº</div>
                            <div class="stat-content">
                                <div class="stat-label">Experience</div>
                                <div class="stat-value">{{ profile.experience_years }} years</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon">üìÑ</div>
                            <div class="stat-content">
                                <div class="stat-label">Resume</div>
                                <div class="stat-value">{% if profile.resume %}Uploaded{% else %}Not uploaded{% endif %}</div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon">üîê</div>
                            <div class="stat-content">
                                <div class="stat-label">Last Login</div>
                                <div class="stat-value">{{ user.last_login|date:"M d, Y" }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Account Security -->
                <div class="security-card">
                    <h3 class="card-title">Account Security</h3>
                    <div class="security-list">
                        <div class="security-item">
                            <span class="security-icon">‚úì</span>
                            <span class="security-text">Email Verified</span>
                        </div>
                        <div class="security-item">
                            <span class="security-icon">üîí</span>
                            <span class="security-text">Password Protected</span>
                        </div>
                    </div>
                    <button class="change-password-btn" onclick="alert('Password change functionality coming soon!')">
                        <span>üîë</span>
                        <span>Change Password</span>
                    </button>
                </div>
            </div>

            <!-- Right Column - Edit Form -->
            <div class="profile-content">
                <!-- Success Message -->
                {% if messages %}
                <div class="messages-container">
                    {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        <span class="alert-icon">{% if message.tags == 'success' %}‚úì{% else %}!{% endif %}</span>
                        <span class="alert-text">{{ message }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Edit Profile Card -->
                <div class="edit-card">
                    <div class="card-header">
                        <h2 class="card-title">Edit Profile</h2>
                        <p class="card-subtitle">Update your personal information and career details</p>
                    </div>

                    <form method="post" enctype="multipart/form-data" class="edit-form">
                        {% csrf_token %}
                        
                        {% if form.errors %}
                        <div class="form-errors">
                            <div class="error-icon">‚ö†Ô∏è</div>
                            <div class="error-content">
                                <h4>Please correct the following errors:</h4>
                                <ul class="error-list">
                                    {% for field, errors in form.errors.items %}
                                        {% for error in errors %}
                                        <li>{{ field|title }}: {{ error }}</li>
                                        {% endfor %}
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                        {% endif %}
                        
                        <div class="form-section">
                            <h3 class="section-title">Career Information</h3>
                            
                            <div class="form-field">
                                <label for="{{ form.job_role.id_for_label }}" class="field-label">
                                    <span class="label-icon">üíº</span>
                                    <span class="label-text">Target Job Role</span>
                                    <span class="label-required">*</span>
                                </label>
                                {{ form.job_role }}
                                <span class="field-hint">What position are you preparing for?</span>
                            </div>
                            
                            <div class="form-field">
                                <label for="{{ form.experience_years.id_for_label }}" class="field-label">
                                    <span class="label-icon">üìä</span>
                                    <span class="label-text">Years of Experience</span>
                                </label>
                                {{ form.experience_years }}
                                <span class="field-hint">Your total professional experience</span>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title">Resume</h3>
                            
                            <div class="form-field">
                                <label for="{{ form.resume.id_for_label }}" class="field-label">
                                    <span class="label-icon">üìÑ</span>
                                    <span class="label-text">Upload Resume</span>
                                </label>
                                
                                {% if profile.resume %}
                                <div class="current-file">
                                    <div class="file-info">
                                        <span class="file-icon">üìé</span>
                                        <span class="file-name">{{ profile.resume.name|slice:"8:" }}</span>
                                        <a href="{{ profile.resume.url }}" class="file-download" target="_blank">
                                            <span>Download</span>
                                            <span>‚Üì</span>
                                        </a>
                                    </div>
                                </div>
                                {% endif %}
                                
                                <div class="file-upload-wrapper">
                                    {{ form.resume }}
                                    <label for="{{ form.resume.id_for_label }}" class="file-upload-label">
                                        <span class="upload-icon">üì§</span>
                                        <span class="upload-text">Choose file or drag and drop</span>
                                        <span class="upload-hint">PDF, DOC, DOCX (Max 5MB)</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="submit-btn">
                                <span class="btn-icon">üíæ</span>
                                <span class="btn-text">Save Changes</span>
                            </button>
                            <button type="reset" class="reset-btn">
                                <span>‚Ü∫</span>
                                <span>Reset</span>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Account Info Card -->
                <div class="account-card">
                    <div class="card-header">
                        <h2 class="card-title">Account Details</h2>
                        <p class="card-subtitle">Your account information and settings</p>
                    </div>

                    <div class="account-details">
                        <div class="detail-row">
                            <div class="detail-label">Username</div>
                            <div class="detail-value">{{ user.username }}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Email Address</div>
                            <div class="detail-value">{{ user.email }}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Member Since</div>
                            <div class="detail-value">{{ user.date_joined|date:"F j, Y" }}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Account Status</div>
                            <div class="detail-value">
                                <span class="status-badge active">Active</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Danger Zone -->
                <div class="danger-card">
                    <div class="card-header">
                        <h2 class="card-title">Danger Zone</h2>
                        <p class="card-subtitle">Irreversible and destructive actions</p>
                    </div>
                    <div class="danger-actions">
                        <div class="danger-item">
                            <div class="danger-info">
                                <h4>Sign Out</h4>
                                <p>Sign out from this device</p>
                            </div>
                            <a href="{% url 'logout' %}" class="danger-btn logout-btn">
                                <span>Sign Out</span>
                                <span>‚Üí</span>
                            </a>
                        </div>
                        <div class="danger-item">
                            <div class="danger-info">
                                <h4>Delete Account</h4>
                                <p>Permanently delete your account and all data</p>
                            </div>
                            <button class="danger-btn delete-btn" onclick="confirmDelete()">
                                <span>Delete</span>
                                <span>‚ö†Ô∏è</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function confirmDelete() {
    if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
        if (confirm('This will permanently delete all your data. Are you absolutely sure?')) {
            alert('Account deletion functionality will be implemented soon. Please contact support for now.');
        }
    }
}

// Calculate profile completion percentage
document.addEventListener('DOMContentLoaded', function() {
    const hasJobRole = {{ profile.job_role|yesno:"true,false" }};
    const hasExperience = {{ profile.experience_years }} > 0;
    const hasResume = {{ profile.resume|yesno:"true,false" }};
    
    let completion = 40; // Base for having an account
    if (hasJobRole) completion += 20;
    if (hasExperience) completion += 20;
    if (hasResume) completion += 20;
    
    // Update the percentage display
    const percentageText = document.querySelector('.percentage-text');
    const progressPath = document.querySelector('.circle-progress');
    
    if (percentageText && progressPath) {
        percentageText.textContent = completion + '%';
        progressPath.setAttribute('stroke-dasharray', completion + ', 100');
    }
});

// File upload enhancement
const fileInput = document.querySelector('input[type="file"]');
if (fileInput) {
    const label = document.querySelector('.file-upload-label');
    
    fileInput.addEventListener('change', function(e) {
        const fileName = e.target.files[0]?.name;
        if (fileName) {
            const uploadText = label.querySelector('.upload-text');
            uploadText.textContent = fileName;
        }
    });
}
</script>

<style>
/* Profile Page Styles */
.profile-page {
    min-height: calc(100vh - 80px);
    background: #f8fafc;
}

.profile-hero {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 3rem 2rem;
}

.hero-container {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.hero-left {
    display: flex;
    align-items: center;
    gap: 2rem;
}

.profile-avatar {
    position: relative;
}

.avatar-circle {
    width: 100px;
    height: 100px;
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 4px solid white;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
}

.avatar-initials {
    font-size: 2.5rem;
    font-weight: 700;
}

.avatar-status {
    position: absolute;
    bottom: 5px;
    right: 5px;
    width: 28px;
    height: 28px;
    background: #10b981;
    border-radius: 50%;
    border: 3px solid white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.875rem;
}

.hero-name {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.hero-role {
    font-size: 1.1rem;
    color: rgba(255, 255, 255, 0.95);
    font-weight: 500;
    margin-bottom: 1rem;
}

.hero-meta {
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    opacity: 0.95;
}

.meta-icon {
    font-size: 1.1rem;
}

.hero-actions {
    display: flex;
    gap: 1rem;
}

.action-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.875rem 1.5rem;
    border-radius: 0.75rem;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.2s;
}

.action-btn.secondary {
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    color: white;
}

.action-btn.secondary:hover {
    background: rgba(255, 255, 255, 0.3);
}

.profile-main {
    max-width: 1400px;
    margin: -2rem auto 0;
    padding: 0 2rem 3rem;
}

.profile-grid {
    display: grid;
    grid-template-columns: 350px 1fr;
    gap: 2rem;
}

/* Sidebar */
.profile-sidebar {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.stats-card,
.quick-stats-card,
.security-card {
    background: white;
    border-radius: 1rem;
    padding: 1.5rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
}

.card-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 1rem;
}

.completion-wrapper {
    text-align: center;
}

.completion-circle {
    position: relative;
    width: 120px;
    height: 120px;
    margin: 0 auto 1rem;
}

.circular-chart {
    width: 100%;
    height: 100%;
}

.circle-bg {
    fill: none;
    stroke: #e2e8f0;
    stroke-width: 3;
}

.circle-progress {
    fill: none;
    stroke: #667eea;
    stroke-width: 3;
    stroke-linecap: round;
    transform: rotate(-90deg);
    transform-origin: 50% 50%;
    transition: stroke-dasharray 0.6s ease;
}

.percentage-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 1.75rem;
    font-weight: 700;
    color: #1e293b;
}

.completion-hint {
    font-size: 0.875rem;
    color: #64748b;
    margin: 0;
}

.stats-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.stat-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: #f8fafc;
    border-radius: 0.75rem;
}

.stat-icon {
    font-size: 1.75rem;
}

.stat-label {
    font-size: 0.8125rem;
    color: #64748b;
    margin-bottom: 0.25rem;
}

.stat-value {
    font-size: 0.95rem;
    font-weight: 600;
    color: #1e293b;
}

.security-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-bottom: 1rem;
}

.security-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.9rem;
    color: #475569;
}

.security-icon {
    color: #10b981;
    font-weight: bold;
}

.change-password-btn {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem;
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 0.5rem;
    color: #475569;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
}

.change-password-btn:hover {
    background: #e2e8f0;
}

/* Main Content */
.profile-content {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.messages-container {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.alert {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem 1.5rem;
    border-radius: 0.75rem;
    font-size: 0.95rem;
}

.alert-success {
    background: #dcfce7;
    color: #166534;
    border: 1px solid #bbf7d0;
}

.alert-error {
    background: #fee2e2;
    color: #991b1b;
    border: 1px solid #fecaca;
}

.alert-icon {
    font-weight: bold;
    font-size: 1.25rem;
}

.edit-card,
.account-card,
.danger-card {
    background: white;
    border-radius: 1rem;
    padding: 2rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
}

.card-header {
    margin-bottom: 2rem;
}

.card-subtitle {
    color: #64748b;
    font-size: 0.95rem;
    margin: 0;
}

.form-errors {
    display: flex;
    gap: 1rem;
    padding: 1.5rem;
    background: #fee2e2;
    border: 1px solid #fecaca;
    border-radius: 0.75rem;
    margin-bottom: 2rem;
}

.error-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
}

.error-content h4 {
    color: #991b1b;
    font-size: 0.95rem;
    margin-bottom: 0.5rem;
}

.error-list {
    margin: 0;
    padding-left: 1.25rem;
    color: #991b1b;
    font-size: 0.875rem;
}

.error-list li {
    margin-bottom: 0.25rem;
}

.form-section {
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid #e2e8f0;
}

.form-section:last-of-type {
    border-bottom: none;
}

.section-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 1.5rem;
}

.form-field {
    margin-bottom: 1.5rem;
}

.field-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
    font-size: 0.875rem;
    color: #334155;
    margin-bottom: 0.5rem;
}

.label-icon {
    font-size: 1.1rem;
}

.label-required {
    color: #ef4444;
}

.form-field input[type="text"],
.form-field input[type="number"],
.form-field select {
    width: 100%;
    padding: 0.875rem 1rem;
    border: 2px solid #e2e8f0;
    border-radius: 0.75rem;
    font-size: 1rem;
    font-family: inherit;
    transition: all 0.2s;
}

.form-field input:focus,
.form-field select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.field-hint {
    display: block;
    font-size: 0.8125rem;
    color: #64748b;
    margin-top: 0.5rem;
}

.current-file {
    margin-bottom: 1rem;
}

.file-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    background: #f8fafc;
    border-radius: 0.75rem;
}

.file-icon {
    font-size: 1.5rem;
}

.file-name {
    flex: 1;
    font-size: 0.9rem;
    color: #475569;
}

.file-download {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.5rem 1rem;
    background: #667eea;
    color: white;
    border-radius: 0.5rem;
    text-decoration: none;
    font-size: 0.875rem;
    font-weight: 500;
    transition: background 0.2s;
}

.file-download:hover {
    background: #5568d3;
}

.file-upload-wrapper {
    position: relative;
}

.file-upload-wrapper input[type="file"] {
    position: absolute;
    opacity: 0;
    pointer-events: none;
}

.file-upload-label {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    border: 2px dashed #cbd5e1;
    border-radius: 0.75rem;
    background: #f8fafc;
    cursor: pointer;
    transition: all 0.2s;
}

.file-upload-label:hover {
    border-color: #667eea;
    background: #f1f5f9;
}

.upload-icon {
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.upload-text {
    font-size: 0.95rem;
    font-weight: 500;
    color: #475569;
    margin-bottom: 0.25rem;
}

.upload-hint {
    font-size: 0.8125rem;
    color: #64748b;
}

.form-actions {
    display: flex;
    gap: 1rem;
    padding-top: 1rem;
}

.submit-btn {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 1rem 2rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    border-radius: 0.75rem;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s;
}

.submit-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
}

.reset-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem 1.5rem;
    background: #f1f5f9;
    color: #475569;
    border: none;
    border-radius: 0.75rem;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
}

.reset-btn:hover {
    background: #e2e8f0;
}

.account-details {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.detail-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: #f8fafc;
    border-radius: 0.75rem;
}

.detail-label {
    font-size: 0.9rem;
    color: #64748b;
    font-weight: 500;
}

.detail-value {
    font-size: 0.95rem;
    color: #1e293b;
    font-weight: 600;
}

.status-badge {
    padding: 0.375rem 0.875rem;
    border-radius: 50px;
    font-size: 0.8125rem;
    font-weight: 500;
}

.status-badge.active {
    background: #dcfce7;
    color: #166534;
}

.danger-card {
    border: 2px solid #fee2e2;
}

.danger-actions {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.danger-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    background: #fef2f2;
    border-radius: 0.75rem;
}

.danger-info h4 {
    font-size: 0.95rem;
    color: #1e293b;
    margin-bottom: 0.25rem;
}

.danger-info p {
    font-size: 0.875rem;
    color: #64748b;
    margin: 0;
}

.danger-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 0.5rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
}

.logout-btn {
    background: #f97316;
    color: white;
}

.logout-btn:hover {
    background: #ea580c;
}

.delete-btn {
    background: #ef4444;
    color: white;
}

.delete-btn:hover {
    background: #dc2626;
}

@media (max-width: 1024px) {
    .profile-grid {
        grid-template-columns: 1fr;
    }
    
    .profile-sidebar {
        order: 2;
    }
    
    .profile-content {
        order: 1;
    }
}

@media (max-width: 768px) {
    .hero-container {
        flex-direction: column;
        gap: 2rem;
    }
    
    .hero-left {
        flex-direction: column;
        text-align: center;
    }
    
    .hero-meta {
        justify-content: center;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .danger-item {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
}
</style>
{% endblock %}
